<div class="container">
  <div class="row flex-column flex-md-row">
    <h4 class="mt-3 .text-primary-emphasis">Cart Items {{cartCount}}</h4>
    <div class="  col-lg-8 col-md-10 order-2 order-md-1  " data-bs-spy='scroll'>
      <div class="overflow-scroll" style="height: 80vh; w">
        {{#each products}}
        <div class="card mt-2 card-sm" style="max-width: 100vw;">
          <div class="row g-0">
            <div class="col-md-3">
              <img src="./product-images/{{this.product._id}}.jpg" class="img-fluid rounded-start" alt="...">
            </div>
            <div class="col-md-8">
              <div class="card-body">
                <h5 class="card-title">{{this.product.Name}}</h5>
                <p class="card-text fs-6">{{this.product.description}}</p>

                <button class="btn" onclick="changeQuantity('{{this._id}}','{{this.product._id}}',-1)">-</button>
                <span id="{{this.product._id}}">{{this.quantity}}</span>
                <button onclick="changeQuantity('{{this._id}}','{{this.product._id}}',1)" class="btn">+</button>
                <a class="btn btn-danger btn-sm" href=""> remove</a>
              </div>
            </div>
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    {{! -- summary --}}

    <div class=" col p-0  col-lg-4 col-md-10 order-1 order-md-2 ">
      <div class="m-0 mt-lg-2 mt-md-2  rounded-3 border ps-0 p-3 ">
        <div class="container">
          <h4> Subtotal</h4>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">
                  <p class="fw-normal mb-0">Item</p>
                </th>
                <th scope="col">
                  <p class="fw-normal mb-0">Quantity</p>
                </th>
                <th scope="col">
                  <p class="fw-normal mb-0">Price</p>
                </th>
                <th scope="col">
                  <p class="fw-normal mb-0">Total</p>
                </th>
              </tr>
            </thead>
            <tbody>
              {{#each products}}
              <tr>
                <td>{{this.Name}}</td>
                <td>{{this.quantity}}</td>
                <td>{{this.Price}}</td>
                <td>$40.00</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
          <h6>Your Cart Summary : $55.00</h6>
          <div class="row ">
            <div class="d-grid mt-3">
              <button class="btn btn-success btn-sm" data-bs-target="#exampleModalToggle"
                data-bs-toggle="modal">Checkout</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  ::-webkit-scrollbar {
    width: 10px;
  }

  a {
    text-decoration: none;
  }
</style>

{{!-- modal checkout --}}

<div class="modal fade modal-fullscreen-md-down" id="exampleModalToggle" aria-hidden="true"
  aria-labelledby="exampleModalToggleLabel" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalToggleLabel">Checkout</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h6>Delivery address</h6>
        <div class="  " data-bs-spy='scroll'>
          <div class="overflow-scroll" style="height: 50vh; w">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1"
                checked>
              <label class="form-check-label" for="exampleRadios1">
                <div class="card mb-2">
                  <div class="card-header d-flex">
                    <div class=" p-0 flex-grow-1">ANJITH B</div>
                    <a class=" p-0">edit</a>
                  </div>
                  <div class="card-body pt-1">
                    <h6 class="card-title">Sagar 138(1)</h6>
                    <p class="card-text">Sagara 139 (1)
                      Pathiripally, Kudappanakunnu P O
                      THIRUVANANTHAPURAM, KERALA 695043</p>
                  </div>
                </div>
              </label>
            </div>
            <div class="d-grid col-6 mx-4 w-100 ">
              <button class="btn btn-secondary btn-sm" type="submit" data-bs-target="#exampleModalToggle2"
                data-bs-toggle="modal">Add
                New Address</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer ">
        <div class="container text-center">
          <div class="row">
            <div class="col order-last p-0">
              <button class="btn btn-success w-100 col-6" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal">
                Pay online
              </button>
            </div>
            <div class="col order-first ">
              <button class="btn btn-info w-100 col-6" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal">
                Cash on delivery</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




{{!-- modal add new address --}}

<div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2"
  tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Add a new address</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form class="needs-validation" novalidate id="address">
        <div class="modal-body">
          <select class="form-select" aria-label="Default select example">
            <option selected>Country/Region</option>
            <option value="1">India</option>
          </select>
          <div class="input-group py-2">
            <div>
              <input type="text" value="{{user.Name}}" name="name" placeholder="Frist name" aria-label="First name"
                class="form-control" id="validationCudstom01" required>
              <div class="valid-feedback">Looks good!</div>
              <div class="invalid-feedback">please enter a user name!</div>
            </div>
            <div>
            <input type="text" name="fname" placeholder="Last name" aria-label="Last name" class="form-control">
              <div class="valid-feedback">Looks good!</div>

            </div>
          
          </div>
          <div>
            
            <input type="number" name="contact" id="validationCustom05" class="form-control" placeholder="Phone No" required>
            <div class="invalid-feedback"> incorrect formate pl</div>
          </div>
          <div class="input-group py-2">
            <input type="text" name="House no." placeholder="Flat, House no., Company, Apartment"
              aria-label="First name" class="form-control">
            <input type="text" name="PostCode" placeholder="PostCode" aria-label="Last name" class="form-control">
          </div>
          <input type="text" name="Area" class="form-control" placeholder="Area, Street, Sector, Village">
          <input type="text" name="Landmark" class="form-control mt-2" placeholder="Landmark">
          <div class="input-group py-2">
            <select class="form-select" name="state" aria-label="Default select example">
              <option selected>State</option>
              {{#each statesInIndia}}
              <option value="1">{{this}}</option>
              {{/each}}
            </select>
            <input type="text" name="city" class="form-control" placeholder="Town/City">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-warning" type="submit" >Use
            this address</button>
        </div>
      </form>
    </div>
  </div>
</div>




<script>

  document.getElementById('address').addEventListener('submit', (e) => {
    e.preventDefault()
    const formData = new FormData(document.getElementById('address'));
    const formDataObject = {};
    formData.forEach((value, key) => {
      formDataObject[key] = value;
    })
    $.ajax({
      url: '/add-new-address',
      data: formDataObject,
      method: 'post',
      success:(response) => {
        console.log(response);
        var modaltoggle = new bootstrap.modal(document.getElementById('exampleModalToggle2'));
        modaltoggle.hide();
      },
      error: (error) => {
        console.error(error)
      }
    })



  })
  {{!-- console.log(formDataObjecet)
  function handleSubmitAddress() {
    var country = getElementById('country').value
    var firstName = getElementById('firstName').value
    var LastName = getElementById('lastName').value
    var Phone = getElementById('phone').value
    var S
  } --}}

  function changeQuantity(cartId, proId, count) {
    let quantity = parseInt(document.getElementById(proId).innerHTML)
    count = parseInt(count)
    $.ajax({
      url: '/change-product-quantity',
      data: {
        cart: cartId,
        product: proId,
        count: count,
        quantity: quantity
      },
      method: 'post',
      success: (response) => {
        if (response.removeProduct) {
          $('#example').modal('show');
          alert('product removed from cart')
          location.reload()
        } else {
          document.getElementById(proId).innerHTML = quantity + count
        }
      }
    })
  }


  (() => {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()

</script>

{{!-- data-bs-target="#exampleModalToggle" data-bs-toggle="modal" --}}